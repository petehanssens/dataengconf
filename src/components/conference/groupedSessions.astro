---
import {fetchData} from './allData.astro'

export async function getConfDetail(apiUrl) {
    const conferenceData = await fetchData(apiUrl);
    function FetchSpeakerDetails(id) {
    
        return conferenceData.speakers.filter(obj => {
            return obj.id == id
        })[0]
    }
  conferenceData.sessions.map((e: any) => {
    e.speakerObject = []
    e.speakers.map((s) => {
      const details = FetchSpeakerDetails(s)
      e.speakerObject.push(details)
    })
  })

  const groupedSessions = Object.entries(
    conferenceData.sessions.reduce((acc, { id, title, city, description, startsAt, endsAt, isServiceSession, goodDate, speakerObject }) => {
      if (!acc[goodDate]) {
        acc[goodDate] = [];
      }
      acc[goodDate].push({ id, title, city, description, startsAt, endsAt, isServiceSession, speakerObject });
      return acc;
    }, {})
  ).map(([goodDate, sessions]) => ({ goodDate, sessions }));
  return groupedSessions;
}
---